<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸƒâ€â™‚ï¸ è·‘è€…è¨“ç·´ç›£æ§ V7.0 (Excelç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-blue: #1565C0;
            --accent-orange: #FF6F00;
            --bg-gray: #F0F2F5;
            --text-dark: #333;
            
            /* ACWR å€é–“é¡è‰² */
            --zone-low: #FFB74D;    /* <0.8 */
            --zone-sweet: #66BB6A;  /* 0.8-1.3 (Green) */
            --zone-warn: #FFEE58;   /* 1.3-1.5 (Yellow) */
            --zone-danger: #EF5350; /* >1.5 (Red) */
            
            /* è¨“ç·´å¼·åº¦é¡è‰² */
            --type-interval: #EF5350;
            --type-tempo: #FFA726;
            --type-long: #7E57C2;
            --type-easy: #66BB6A;
            --type-sprint: #29B6F6;
            
            /* Excel æŒ‰éˆ•é¡è‰² */
            --excel-green: #2E7D32;
        }

        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding: 20px;
            color: var(--text-dark);
            line-height: 1.5;
            padding-bottom: 50px; /* ç•™çµ¦ Footer */
        }

        .container { max-width: 900px; margin: 0 auto; display: grid; gap: 20px; }

        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        h2 { border-left: 5px solid var(--accent-orange); padding-left: 10px; margin-top: 0; color: #444; }

        /* --- 1. è¨“ç·´å»ºè­°æ¨£å¼ (ç½®é ‚) --- */
        .advice-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .advice-box { padding: 12px; border-radius: 8px; color: white; font-size: 0.9em; }
        .advice-title { font-weight: bold; display: block; margin-bottom: 4px; }
        .advice-desc { font-size: 0.85em; opacity: 0.95; }

        /* --- è¼¸å…¥èˆ‡å¤©æ°£å€ --- */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .input-group { margin-bottom: 10px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn-add { width: 100%; background: var(--primary-blue); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 1rem; }
        
        .weather-result { background: #E3F2FD; padding: 10px; border-radius: 8px; color: #1565C0; font-weight: bold; margin-top: 10px; }

        /* --- æ—¥æ›†èˆ‡æ¸…å–® --- */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; }
        .day-cell { border: 1px solid #eee; padding: 5px; min-height: 60px; background: white; border-radius: 4px; font-size: 0.8em; position: relative; }
        .run-badge { background: var(--primary-blue); color: white; padding: 2px 4px; border-radius: 4px; cursor: pointer; display: block; margin-top: 2px; text-align: center; font-size: 0.75em; }
        .run-badge:hover { background: var(--zone-danger); }
        
        .checklist-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
        .check-item { border: 1px solid #eee; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 0.9em; text-align: center; background: white; }
        .check-item.checked { background: #E8F5E9; color: green; text-decoration: line-through; border-color: green; }

        /* --- ACWR å„€è¡¨æ¿æ¨£å¼ --- */
        .acwr-dashboard { background: #263238; color: white; }
        .acwr-header { display: flex; justify-content: space-between; align-items: flex-end; }
        .acwr-value { font-size: 2.5em; font-weight: bold; line-height: 1; }
        .meter-container { height: 20px; background: #555; margin: 15px 0; border-radius: 10px; overflow: hidden; }
        .meter-fill { height: 100%; transition: width 0.5s; }
        .zone-markers { display: flex; font-size: 0.75em; color: #ccc; justify-content: space-between; margin-bottom: 15px; }
        
        .acwr-explanation {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9em;
            line-height: 1.6;
        }
        .acwr-explanation strong { color: #81D4FA; }

        /* --- æ–°å¢ï¼šåŒ¯å‡ºæŒ‰éˆ•èˆ‡ Footer æ¨£å¼ --- */
        .btn-excel {
            width: 100%;
            background: var(--excel-green);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background 0.3s;
        }
        .btn-excel:hover { background: #1B5E20; }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #888;
            font-size: 0.9em;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        .footer span {
            font-weight: bold;
            color: var(--primary-blue);
        }

        @media (max-width: 600px) { .input-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:var(--primary-blue); margin-bottom:0;">ğŸƒâ€â™‚ï¸ è·‘è€…ç§‘å­¸ç›£æ§ç«™</h1>

    <div class="card">
        <h2>ğŸ’¡ è¨“ç·´é¡å‹å»ºè­° (RPEå¼·åº¦)</h2>
        <div class="advice-grid">
            <div class="advice-box" style="background: var(--type-easy);">
                <span class="advice-title">ğŸŒ± æ¢å¾©è·‘ (Easy)</span>
                <span class="advice-desc">RPE 1-2 | è¼•é¬†æ’ä¹³é…¸ï¼Œæ…¢åˆ°æƒ³èµ°è·¯ã€‚</span>
            </div>
            <div class="advice-box" style="background: var(--type-long);">
                <span class="advice-title">ğŸ›¤ï¸ é•·è·é›¢ (LSD)</span>
                <span class="advice-desc">RPE 3-4 | æœ‰æ°§è€åŠ›ï¼Œä¿æŒå¯å°è©±é€Ÿåº¦ã€‚</span>
            </div>
            <div class="advice-box" style="background: var(--type-tempo);">
                <span class="advice-title">âš¡ ç¯€å¥è·‘ (Tempo)</span>
                <span class="advice-desc">RPE 7 | æå‡ä¹³é…¸é–¾å€¼ï¼Œæœ‰é»å–˜ä½†èƒ½æ’ä½ã€‚</span>
            </div>
            <div class="advice-box" style="background: var(--type-interval);">
                <span class="advice-title">ğŸ”¥ é–“æ­‡è·‘ (Interval)</span>
                <span class="advice-desc">RPE 9-10 | åˆºæ¿€æœ€å¤§æ”æ°§é‡ï¼Œè·‘å¿«ä¼‘æ…¢ã€‚</span>
            </div>
            <div class="advice-box" style="background: var(--type-sprint);">
                <span class="advice-title">ğŸš€ é‡è¤‡è¡åˆº (Reps)</span>
                <span class="advice-desc">RPE 10 | ç·´ç¥ç¶“å¾µå¬ï¼Œå…¨åŠ›è¡åˆºä¼‘åˆ°é£½ã€‚</span>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="input-grid">
            <div>
                <h2>ğŸ“… æ–°å¢è¨“ç·´</h2>
                <div class="input-group">
                    <label>æ—¥æœŸ</label>
                    <input type="date" id="runDate">
                </div>
                <div class="input-group">
                    <label>è·é›¢ (km)</label>
                    <input type="number" id="runDistance" placeholder="ä¾‹å¦‚: 10" step="0.1">
                </div>
                <button class="btn-add" onclick="addLog()">â• åŠ å…¥ä¸¦è¨ˆç®—</button>
            </div>
            <div>
                <h2>â˜ï¸ ç©¿è‘—å»ºè­°</h2>
                <div class="input-group">
                    <label>æ°£æº«: <span id="tempVal">20</span>Â°C / å¤©æ°£</label>
                    <input type="range" id="tempInput" min="5" max="38" value="20" oninput="updateWeather()">
                    <select id="weatherInput" onchange="updateWeather()" style="margin-top:5px;">
                        <option value="sunny">â˜€ï¸ æ™´æœ—/å¤šé›²</option>
                        <option value="cloudy">â˜ï¸ é™°å¤©</option>
                        <option value="rain">ğŸŒ§ï¸ ä¸‹é›¨</option>
                        <option value="humid">ğŸ’§ æ‚¶ç†±æ½®æ¿•</option>
                        <option value="cold">â„ï¸ å¯’æµ/å¼·é¢¨</option>
                    </select>
                </div>
                <div class="weather-result" id="outfitResult">è¨ˆç®—ä¸­...</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <button onclick="moveMonth(-1)">â—€</button>
            <strong id="calTitle"></strong>
            <button onclick="moveMonth(1)">â–¶</button>
        </div>
        <div class="calendar-grid" id="calGrid"></div>
        <p style="text-align:center; font-size:0.8em; color:#999;">ğŸ’¡ é»æ“Šè—è‰²é‡Œç¨‹å¯åˆªé™¤ç´€éŒ„</p>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <h2 style="margin:0;">ğŸ’ å‡ºç™¼å‰æª¢æŸ¥</h2>
            <button onclick="resetChecklist()" style="background:#eee; border:none; padding:5px 10px; cursor:pointer; border-radius:4px;">é‡ç½®</button>
        </div>
        <div class="checklist-grid" id="checklistArea"></div>
    </div>

    <div class="card acwr-dashboard">
        <div class="acwr-header">
            <div>
                <h2>ğŸ“Š ACWR å‚·ç—›ç›£æ§</h2>
                <span style="opacity:0.8;">Acute:Chronic Workload Ratio</span>
            </div>
            <div style="text-align: right;">
                <div class="acwr-value" id="acwrDisplay">--</div>
                <span id="acwrStatus" style="font-weight:bold;">è¨ˆç®—ä¸­</span>
            </div>
        </div>

        <div class="meter-container">
            <div id="acwrBar" class="meter-fill" style="width: 0%; background: #ccc;"></div>
        </div>
        <div class="zone-markers">
            <span>0.0</span>
            <span>0.8 (éä½)</span>
            <span>1.3 (ç”œèœœé»)</span>
            <span>1.5 (å±éšª)</span>
            <span>2.0+</span>
        </div>

        <div class="acwr-explanation">
            <div><strong>ğŸ“Œ ä»€éº¼æ˜¯ ACWRï¼Ÿ</strong></div>
            é€™æ˜¯é‹å‹•ç§‘å­¸ç•Œé é˜²å—å‚·çš„é»ƒé‡‘æŒ‡æ¨™ã€‚è¨ˆç®—å…¬å¼ç‚ºï¼š
            <div style="margin:5px 0; padding-left:10px; border-left:3px solid #81D4FA;">
                <em>æ€¥æ€§è² è· (ç–²å‹ / è¿‘7å¤©è·‘é‡) Ã· æ…¢æ€§è² è· (é«”èƒ½ / è¿‘28å¤©å¹³å‡é€±è·‘é‡)</em>
            </div>
        </div>
    </div>

    <div class="card" style="text-align: center;">
        <h2>ğŸ“¥ è³‡æ–™å‚™ä»½</h2>
        <button class="btn-excel" onclick="exportToExcel()">
            ğŸ“Š åŒ¯å‡ºè¨“ç·´ç´€éŒ„æˆ Excel (.xlsx)
        </button>
        <p style="color:#666; font-size:0.9em; margin-top:10px;">é»æ“ŠæŒ‰éˆ•å¾Œï¼Œå°‡è‡ªå‹•ä¸‹è¼‰æ‰€æœ‰çš„è¨“ç·´è³‡æ–™ã€‚</p>
    </div>

    <div class="footer">
        Created By <span>HDL</span> | è·‘è€…ç§‘å­¸ç›£æ§ç«™
    </div>

</div>

<script>
    // --- æ ¸å¿ƒé‚è¼¯ (Javascript) ---
    
    // 1. ACWR è¨ˆç®—
    function updateACWR() {
        const today = new Date();
        const oneDay = 24 * 60 * 60 * 1000;
        let acuteSum = 0, chronicSum = 0;

        logs.forEach(log => {
            const diff = Math.floor((today - new Date(log.date)) / oneDay);
            if (diff >= 0 && diff < 7) acuteSum += log.dist;
            if (diff >= 0 && diff < 28) chronicSum += log.dist;
        });

        const chronicAvg = chronicSum / 4; 
        let ratio = (chronicAvg > 0) ? (acuteSum / chronicAvg).toFixed(2) : 0;
        
        // UI æ›´æ–°
        const display = document.getElementById('acwrDisplay');
        const status = document.getElementById('acwrStatus');
        const bar = document.getElementById('acwrBar');

        if (chronicAvg === 0) {
            display.innerText = "--";
            status.innerText = "æ•¸æ“šç´¯ç©ä¸­";
            bar.style.width = "5%";
            bar.style.background = "#ccc";
            return;
        }

        display.innerText = ratio;
        let w = Math.min((ratio / 2.0) * 100, 100) + "%";
        bar.style.width = w;

        if (ratio < 0.8) {
            status.innerText = "ğŸ“‰ è¨“ç·´é‡åä½";
            bar.style.background = "var(--zone-low)";
        } else if (ratio <= 1.3) {
            status.innerText = "âœ… ç”œèœœé» (æœ€ä½³)";
            bar.style.background = "var(--zone-sweet)";
        } else if (ratio <= 1.5) {
            status.innerText = "âš ï¸ è­¦æˆ’å€";
            bar.style.background = "var(--zone-warn)";
        } else {
            status.innerText = "ğŸš« å±éšªå€ (æ˜“å—å‚·)";
            bar.style.background = "var(--zone-danger)";
        }
    }

    // 2. è³‡æ–™åº«èˆ‡æ—¥æ›†
    let logs = JSON.parse(localStorage.getItem('runLogs_v6')) || [];
    let curDate = new Date();
    document.getElementById('runDate').valueAsDate = new Date();

    function addLog() {
        const d = document.getElementById('runDate').value;
        const k = parseFloat(document.getElementById('runDistance').value);
        if(!d || isNaN(k)) return alert("è«‹è¼¸å…¥æ­£ç¢ºæ•¸å€¼");
        logs.push({date: d, dist: k});
        save();
        alert("ç´€éŒ„æˆåŠŸï¼ACWR å·²æ›´æ–°");
    }

    function delLog(idx) {
        if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ")) {
            logs.splice(idx, 1);
            save();
        }
    }

    function save() {
        logs.sort((a,b) => new Date(a.date) - new Date(b.date));
        localStorage.setItem('runLogs_v6', JSON.stringify(logs));
        renderCal();
        updateACWR();
    }

    function renderCal() {
        const grid = document.getElementById('calGrid');
        grid.innerHTML = '';
        const y = curDate.getFullYear(), m = curDate.getMonth();
        document.getElementById('calTitle').innerText = `${y}å¹´ ${m+1}æœˆ`;

        // æ˜ŸæœŸé ­
        ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(d => grid.innerHTML+=`<div style="text-align:center;color:#888;font-size:0.8em;">${d}</div>`);
        
        const first = new Date(y, m, 1).getDay();
        const days = new Date(y, m+1, 0).getDate();
        
        for(let i=0; i<first; i++) grid.innerHTML += '<div></div>';
        
        for(let d=1; d<=days; d++) {
            const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            let html = `<div class="day-cell"><div>${d}</div>`;
            logs.forEach((l, i) => {
                if(l.date === dateStr) html += `<span class="run-badge" onclick="delLog(${i})">${l.dist}k</span>`;
            });
            html += `</div>`;
            grid.innerHTML += html;
        }
    }
    function moveMonth(v) { curDate.setMonth(curDate.getMonth()+v); renderCal(); }

    // 3. å¤©æ°£èˆ‡è£å‚™
    function updateWeather() {
        const t = document.getElementById('tempInput').value;
        const w = document.getElementById('weatherInput').value;
        document.getElementById('tempVal').innerText = t;
        let s = (t>=28)?"ğŸ½èƒŒå¿ƒçŸ­è¤²":(t>=20)?"ğŸ‘•çŸ­è¢–çŸ­è¤²":(t>=15)?"ğŸ‘•è–„é•·è¢–çŸ­è¤²":"ğŸ§¥å¤–å¥—é•·è¤²";
        if(w==='rain') s+=" + ğŸ§¢é´¨èˆŒå¸½(æ“‹é›¨) + ğŸ§¥é˜²æ°´è¡£";
        if(w==='humid') s+=" + ğŸ’§å¤šè£œæ°´";
        if(w==='cold') s+=" + ğŸ§£è„–åœä¿æš–";
        document.getElementById('outfitResult').innerText = s;
    }

    const checkItems = ["ğŸ“±æ‰‹æ©Ÿ","ğŸ‘›éŒ¢åŒ…","ğŸ”‘é‘°åŒ™","ğŸ’³å­¸ç”Ÿè­‰","ğŸ’§æ°´å£º","ğŸ‘“çœ¼é¡","â˜‚ï¸é›¨å‚˜","âŒšæ‰‹éŒ¶","ğŸ«èƒ½é‡è† ","ğŸ‘•æ›æ´—è¡£ç‰©","ğŸ§£æ¯›å·¾","ğŸ§¢å¸½å­","ğŸ‘Ÿè·‘é‹","ğŸ§´å‡¡å£«æ—","ğŸ§è€³æ©Ÿ"];
    function renderChecklist() {
        const area = document.getElementById('checklistArea');
        area.innerHTML = checkItems.map(i => `<div class="check-item" onclick="this.classList.toggle('checked')">${i}</div>`).join('');
    }
    function resetChecklist() { document.querySelectorAll('.check-item').forEach(e => e.classList.remove('checked')); }

    // 4. æ–°å¢ï¼šåŒ¯å‡º Excel åŠŸèƒ½
    function exportToExcel() {
        if(logs.length === 0) {
            alert("ç›®å‰æ²’æœ‰ç´€éŒ„å¯ä»¥åŒ¯å‡ºå–”ï¼");
            return;
        }

        // æ•´ç†è³‡æ–™æ ¼å¼
        const data = logs.map(log => ({
            "æ—¥æœŸ": log.date,
            "è·é›¢ (km)": log.dist,
            "ç´€éŒ„æ™‚é–“": new Date().toLocaleString()
        }));

        // å»ºç«‹å·¥ä½œè¡¨
        const worksheet = XLSX.utils.json_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "è·‘æ­¥ç´€éŒ„");

        // ä¸‹è¼‰æª”æ¡ˆ
        XLSX.writeFile(workbook, "My_Run_Logs_HDL.xlsx");
    }

    // åˆå§‹åŒ–
    renderCal();
    renderChecklist();
    updateWeather();
    updateACWR();
</script>

</body>
</html>